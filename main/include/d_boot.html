<!doctype html>
<!--suppress ALL -->
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <!-- Jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.js"></script>
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
            crossorigin="anonymous"></script>

    <title>Dragrace</title>
<!-----------------------------

   Programme f체r Dragrace

------------------------------->
    <script>
        //Json Status String von ESP32 lesen
        function d_json(){
            $.getJSON( "http://192.168.1.106/zahl"/*, function (d){$('#L1').text(d.Zeit-L2);}*/)
                .done(function( json ) {
                    $('#zahl').text(JSON.stringify(json));
                    $('#L1').text(json.Zeit_L1);
                    $('#stat :button').removeClass("btn-success");
                    $('#start').unbind();

                    if(json.Status & (1)){ //Gestartet
                        $('#bt_state_startet').addClass("btn-success");
                    }
                    if(json.Status & (1<<1)){ //L채uft
                        $('#bt_state_runing').addClass("btn-success");
                        $('#start').click(function (){
                            $('#start').unbind();$.get("http://192.168.1.106/start?action=neu");
                        });
                            $('#start').removeClass('btn-primary btn-success');$('#start').addClass('btn-danger');
                        $('#start').html('Stop');

                    }
                    if(json.Status & (1<<2)){ //Ready
                        $('#bt_state_ready').addClass("btn-success");
                        $('#start').click(function (){
                            $('#start').unbind();$.get("http://192.168.1.106/start?action=start");
                        });
                            $('#start').removeClass('btn-primary btn-danger');$('#start').addClass('btn-success');
                        $('#start').html('Start');
                    }
                    if(json.Status & (1<<3)){//Fertig
                        $('#bt_state_finsish').addClass("btn-success");
                    }



                })
                .fail(function( jqxhr, textStatus, error ) {
                    var err = textStatus + ", " + error;
                    console.log( "Request Failed: " + err );
                })
            ;
        }
        /*Dokument geladen*/
        $(document).ready(function () {
            var refreshInterval = '';

            $.ajaxSetup({timeout:5000}); //in milliseconds

            // Auto Refresh on
            refreshInterval=setInterval(function(){
                d_json();
                $('#auto-refresh').html('Stop auto Refresh');
            },500);


            // Reload Knopf
            $("#refresh").hide();
            $("#refresh").click(function () {
                d_json();
            });

            // Start Knopf
            $("#start").click(function () {
                // $.get("http://192.168.1.106/start?action=start");
            });

            // Refresh Checkbox
            $('#refresh-check-box').prop('checked',true);
            $('#refresh-check-box').click(function (){
                if($('#refresh-check-box').is(':checked')){
                    // Refresh on
                    refreshInterval=setInterval(function(){
                        $("#refresh").hide();
                        d_json();
                    },500);
                }else{
                    clearInterval(refreshInterval);
                    $("#refresh").show();
                }

            });

            // Refresh Knopf
            $("#auto-refresh").click(function () {
                if(refreshInterval){
                    // Refresh off
                    clearInterval(refreshInterval);
                    $('#auto-refresh').html('Start auto Refresh');
                    refreshInterval='';
                }else {
                    // Refresh on
                    refreshInterval=setInterval(function(){
                        d_json();
                        $('#auto-refresh').html('Stop auto Refresh');
                    },500);
                }
            });

        });
    </script>

</head>

<body>


<div class="container text-center">

    <!--Bedinung-->
    <div class="card">
        <div class="card-header h1"> Dragrace</div>
        <div class="card-body h-50">
            <!--Start-Knopf-->
            <button style="height: 100px !important;" id="start" type="button" class="w-100 btn h-75 btn-primary">Start</button>
            <!--Auto Refresh checkbox-->
            <div class="form-check d-md-inline-block" style="text-align: left!important;">
                <input class="form-check-input" type="checkbox" value="1" id="refresh-check-box">
                <label class="form-check-label"  for="refresh-check-box">
                    auto Refresh
                </label>
            </div>
            <!--Auto Refresh-Knopf-->
            <!--<button id="auto-refresh" type="button" class=" btn  btn-info mt-1">Start auto Refresh</button>-->
            <!--Refresh-Knopf-->
            <button id="refresh" type="button" class=" btn  btn-info mt-1">Reload</button>
        </div>
    </div>
    <!--Ausgabe Status-->
    <div id="stat" class="card mt-3">
        <div class="card-header "> Status</div>
        <div class="card-body h-50 ">
            <button id="bt_state_ready">Ready</button>
            <button id="bt_state_startet">Gestartet</button>
            <button id="bt_state_runing">L채uft</button>
            <button id="bt_state_finsish">Fertig</button>
        </div>
    </div>
    <!--Ausgabe Zeiten-->
    <div class="card mt-3">
        <div class="card-header "> Zeit</div>
        <div class="card-body h-50 ">
            <div class="container">
                <div class="row">
                    <div class="col">
                        <!--Links-->
                        <div class="card border-1">
                            <div class="card-header">Links </div>
                            <div class="card-body">
                                <button id="bt_state_L1">L1</button>
                                <button id="bt_state_L2">L2</button>
                                <button id="bt_state_L3">L3</button>
                                <button id="bt_state_LSieg">Sieg</button>
                                <button id="bt_state_lFuehstart">Fr체hstart</button>
                                <p> <span>1: </span><span  id="L1"></span></p>
                                <p> <span>2: </span><span  id="L2"></span></p>

                            </div>
                        </div>

                    </div>
                    <div class="col">
                        <!--Rechts-->
                        <div class="card">
                            <div class="card-header">Rechts </div>
                        </div>

                    </div>

                </div>
            </div>
            <p id="zahl">Zahl</p>
        </div>
    </div>


</div>



</body>
</html>